<mat-sidenav-container class="product-detail-container">
  <mat-sidenav #sidenav [opened]="sidebarOpened" [mode]="'side'" class="product-sidenav">
    <app-sidebar></app-sidebar>
  </mat-sidenav>

  <mat-sidenav-content>
    <app-navbar (toggleSidebar)="onToggleSidebar()"></app-navbar>

    <div class="product-detail-content">
      <app-loading *ngIf="loading"></app-loading>

      <div *ngIf="!loading && product">
        <div class="header">
          <div class="left">
            <h1>{{ product.name }}</h1>
            <p class="subtitle">{{ product.category?.name || 'Sin categoría' }}</p>
          </div>
          <div class="actions">
            <button mat-stroked-button (click)="editProduct()">
              <mat-icon>edit</mat-icon> Editar
            </button>
            <button mat-raised-button color="warn" (click)="deleteProduct()">
              <mat-icon>delete</mat-icon> Eliminar
            </button>
          </div>
        </div>

        <mat-card class="detail-card">
          <mat-card-content>
            <div class="detail-grid">
              <div class="image">
                <img [src]="product.image_url || 'https://via.placeholder.com/400x300?text=Sin+Imagen'" alt="{{ product.name }}">
              </div>
              <div class="info">
                <p><strong>Precio:</strong> {{ formatCurrency(product.price) }}</p>
                <p><strong>Stock:</strong> {{ product.stock }}</p>
                <p><strong>Descripción:</strong></p>
                <p class="description">{{ product.description }}</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="movements-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>history</mat-icon> Movimientos relacionados
            </mat-card-title>
            <button mat-button color="primary" (click)="navigateTo('/movements')">
              Ver todos <mat-icon>arrow_forward</mat-icon>
            </button>
          </mat-card-header>
          <mat-card-content>
            <table mat-table [dataSource]="recentMovements" class="movements-table">
              <ng-container matColumnDef="type">
                <th mat-header-cell *matHeaderCellDef>Tipo</th>
                <td mat-cell *matCellDef="let m">{{ m.type }}</td>
              </ng-container>

              <ng-container matColumnDef="quantity">
                <th mat-header-cell *matHeaderCellDef>Cantidad</th>
                <td mat-cell *matCellDef="let m">{{ m.quantity }}</td>
              </ng-container>

              <ng-container matColumnDef="user">
                <th mat-header-cell *matHeaderCellDef>Usuario</th>
                <td mat-cell *matCellDef="let m">{{ m.user?.username || 'N/A' }}</td>
              </ng-container>

              <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef>Fecha</th>
                <td mat-cell *matCellDef="let m">{{ formatDate(m.movement_date) }}</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="['type','quantity','user','date']"></tr>
              <tr mat-row *matRowDef="let row; columns: ['type','quantity','user','date'];"></tr>
            </table>

            <p *ngIf="recentMovements.length === 0" class="no-data">No hay movimientos para este producto</p>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>