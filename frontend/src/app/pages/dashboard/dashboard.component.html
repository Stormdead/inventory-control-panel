<mat-sidenav-container class="dashboard-container">
  <!-- Sidebar -->
  <mat-sidenav 
    #sidenav 
    [opened]="sidebarOpened" 
    [mode]="'side'"
    class="dashboard-sidenav">
    <app-sidebar></app-sidebar>
  </mat-sidenav>

  <!-- Main Content -->
  <mat-sidenav-content>
    <!-- Navbar -->
    <app-navbar (toggleSidebar)="onToggleSidebar()"></app-navbar>

    <!-- Content -->
    <div class="dashboard-content">
      <app-loading *ngIf="loading"></app-loading>

      <div *ngIf="!loading">
        <!-- Header -->
        <div class="dashboard-header">
          <h1>Dashboard</h1>
          <p class="subtitle">Vista general del inventario</p>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid" *ngIf="stats">
          <mat-card class="stat-card card-blue">
            <mat-card-content>
              <div class="stat-icon">
                <mat-icon>inventory</mat-icon>
              </div>
              <div class="stat-info">
                <h3>{{ stats.total_products }}</h3>
                <p>Total Productos</p>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card card-green">
            <mat-card-content>
              <div class="stat-icon">
                <mat-icon>category</mat-icon>
              </div>
              <div class="stat-info">
                <h3>{{ stats.total_categories }}</h3>
                <p>CategorÃ­as</p>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card card-orange">
            <mat-card-content>
              <div class="stat-icon">
                <mat-icon>warehouse</mat-icon>
              </div>
              <div class="stat-info">
                <h3>{{ stats.total_stock }}</h3>
                <p>Stock Total</p>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card card-red">
            <mat-card-content>
              <div class="stat-icon">
                <mat-icon>warning</mat-icon>
              </div>
              <div class="stat-info">
                <h3>{{ stats.low_stock_products }}</h3>
                <p>Stock Bajo</p>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card card-purple">
            <mat-card-content>
              <div class="stat-icon">
                <mat-icon>attach_money</mat-icon>
              </div>
              <div class="stat-info">
                <h3>{{ formatCurrency(stats.total_inventory_value) }}</h3>
                <p>Valor Inventario</p>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card card-teal">
            <mat-card-content>
              <div class="stat-icon">
                <mat-icon>people</mat-icon>
              </div>
              <div class="stat-info">
                <h3>{{ stats.total_users }}</h3>
                <p>Usuarios</p>
              </div>
            </mat-card-content>
          </mat-card>
        </div>

        <!-- Charts -->
        <div class="charts-grid">
          <!-- Movement Chart -->
          <mat-card class="chart-card">
            <mat-card-header>
              <mat-card-title>Movimientos del Mes</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="chart-container">
                <canvas 
                  baseChart
                  [data]="movementChartData"
                  [options]="movementChartOptions"
                  type="bar">
                </canvas>
              </div>
              <div class="chart-summary" *ngIf="movementSummary">
                <div class="summary-item">
                  <span class="label">Total Entradas:</span>
                  <span class="value">{{ movementSummary.total_entradas }}</span>
                </div>
                <div class="summary-item">
                  <span class="label">Total Salidas:</span>
                  <span class="value">{{ movementSummary.total_salidas }}</span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Top Products Chart -->
          <mat-card class="chart-card">
            <mat-card-header>
              <mat-card-title>Top 5 Productos</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="chart-container">
                <canvas 
                  baseChart
                  [data]="topProductsChartData"
                  [options]="topProductsChartOptions"
                  type="doughnut">
                </canvas>
              </div>
            </mat-card-content>
          </mat-card>
        </div>

        <!-- Tables Grid -->
        <div class="tables-grid">
          <!-- Recent Movements -->
          <mat-card class="table-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>history</mat-icon>
                Movimientos Recientes
              </mat-card-title>
              <button mat-button color="primary" (click)="navigateTo('/movements')">
                Ver todos
                <mat-icon>arrow_forward</mat-icon>
              </button>
            </mat-card-header>
            <mat-card-content>
              <table mat-table [dataSource]="recentMovements" class="movements-table">
                <!-- Product Column -->
                <ng-container matColumnDef="product">
                  <th mat-header-cell *matHeaderCellDef>Producto</th>
                  <td mat-cell *matCellDef="let movement">
                    {{ movement.product?.name || 'N/A' }}
                  </td>
                </ng-container>

                <!-- Type Column -->
                <ng-container matColumnDef="type">
                  <th mat-header-cell *matHeaderCellDef>Tipo</th>
                  <td mat-cell *matCellDef="let movement">
                    <mat-chip [class]="getMovementTypeClass(movement.type)">
                      {{ movement.type === 'entrada' ? 'Entrada' : 'Salida' }}
                    </mat-chip>
                  </td>
                </ng-container>

                <!-- Quantity Column -->
                <ng-container matColumnDef="quantity">
                  <th mat-header-cell *matHeaderCellDef>Cantidad</th>
                  <td mat-cell *matCellDef="let movement">
                    {{ movement.quantity }}
                  </td>
                </ng-container>

                <!-- Date Column -->
                <ng-container matColumnDef="date">
                  <th mat-header-cell *matHeaderCellDef>Fecha</th>
                  <td mat-cell *matCellDef="let movement">
                    {{ formatDate(movement.movement_date) }}
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
              </table>

              <p *ngIf="recentMovements.length === 0" class="no-data">
                No hay movimientos recientes
              </p>
            </mat-card-content>
          </mat-card>

          <!-- Low Stock Alerts -->
          <mat-card class="table-card alert-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>warning</mat-icon>
                Alertas de Stock Bajo
              </mat-card-title>
              <button mat-button color="warn" (click)="navigateTo('/products')">
                Ver todos
                <mat-icon>arrow_forward</mat-icon>
              </button>
            </mat-card-header>
            <mat-card-content>
              <div class="low-stock-list">
                <div 
                  *ngFor="let product of lowStockProducts" 
                  class="low-stock-item"
                  [class]="getStockClass(product.stock)">
                  <div class="product-info">
                    <span class="product-name">{{ product.name }}</span>
                    <span class="product-category">{{ product.category?.name || 'Sin categorÃ­a' }}</span>
                  </div>
                  <div class="stock-badge">
                    <mat-icon>inventory_2</mat-icon>
                    <span>{{ product.stock }}</span>
                  </div>
                </div>
              </div>

              <p *ngIf="lowStockProducts.length === 0" class="no-data">
                Â¡Todo el inventario estÃ¡ bien abastecido! ðŸŽ‰
              </p>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>