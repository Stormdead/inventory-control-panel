<mat-sidenav-container class="movement-list-container">
  <mat-sidenav #sidenav [opened]="sidebarOpened" [mode]="'side'">
    <app-sidebar></app-sidebar>
  </mat-sidenav>

  <mat-sidenav-content>
    <app-navbar (toggleSidebar)="sidebarOpened = !sidebarOpened"></app-navbar>

    <div class="movement-content" style="padding:24px;">
      <div class="page-header" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h2><mat-icon>swap_horiz</mat-icon> Movimientos</h2>
        <div>
          <mat-form-field appearance="outline" style="width:160px;margin-right:12px;">
            <mat-label>Tipo</mat-label>
            <mat-select [(value)]="filterType" (selectionChange)="onTypeChange($event.value)">
              <mat-option value="all">Todos</mat-option>
              <mat-option value="entrada">Entradas</mat-option>
              <mat-option value="salida">Salidas</mat-option>
            </mat-select>
          </mat-form-field>
          <button mat-raised-button color="primary" (click)="createMovement()"><mat-icon>add</mat-icon> Nuevo</button>
        </div>
      </div>

      <app-loading *ngIf="loading"></app-loading>

      <div *ngIf="!loading">
        <table mat-table [dataSource]="movements" class="movements-table" style="width:100%;">
          <ng-container matColumnDef="product">
            <th mat-header-cell *matHeaderCellDef>Producto</th>
            <td mat-cell *matCellDef="let m">{{ m.product?.name || 'N/A' }}</td>
          </ng-container>

          <ng-container matColumnDef="type">
            <th mat-header-cell *matHeaderCellDef>Tipo</th>
            <td mat-cell *matCellDef="let m">{{ m.type }}</td>
          </ng-container>

          <ng-container matColumnDef="quantity">
            <th mat-header-cell *matHeaderCellDef>Cantidad</th>
            <td mat-cell *matCellDef="let m">{{ m.quantity }}</td>
          </ng-container>

          <ng-container matColumnDef="user">
            <th mat-header-cell *matHeaderCellDef>Usuario</th>
            <td mat-cell *matCellDef="let m">{{ m.user?.username || 'N/A' }}</td>
          </ng-container>

          <ng-container matColumnDef="date">
            <th mat-header-cell *matHeaderCellDef>Fecha</th>
            <td mat-cell *matCellDef="let m">{{ formatDate(m.movement_date) }}</td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>

        <p *ngIf="movements.length === 0" class="no-data">No hay movimientos a√∫n</p>
      </div>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>